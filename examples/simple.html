<!DOCTYPE html>
<html>

	<head>

		<title>Simple example</title>

		<link
		  rel="stylesheet"
		  href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
		/>
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

		<style>
			.centre {
				display: block;
				text-align: center;
				margin-left: auto;
				margin-right: auto;
			}

			.ctrl-button {
				width: 6rem;
			}
		</style>

	</head>
	<body>

		<header class="container" >
			<nav>
				<ul>
					<li><b>Vtml test</b></li>
				</ul>
			</nav>
		</header>

		<main class="container" >

			<!-- create form -->
			<form v-name="create_todo" method="POST" >
				<v-sql-action>
					insert into simple.todos (text) values ($body.text)
				</v-sql-action>
				<fieldset role="group" >
					<input name="text" type="text" autofocus="yes" maxlength="128" required />
					<button type="submit" class="material-icons" >add</button>
				</fieldset>
			</form>

			<hr/>

			<!-- Get the todos -->
			<v-sql target="todos" >
				select * from simple.todos where $.query.showdone::boolean is not null or done = false order by c desc
			</v-sql>

			<v-nodejs target="ntodos" >
				return $todos.length
			</v-nodejs>

			<p>There are $ntodos todos</p>

			<!-- Loop through the todos -->
			<v-for-each source="$todos" >

				<!-- Form to update the text -->
				<form method="POST" v-name="edit_todo" >
					<v-sql-action>
						update simple.todos set text = $body.text where _id = $.body.id
					</v-sql-action>
					<fieldset role="group" >

						<input name="text" value="$text" maxlength="128" disabled />
						<input type="hidden" name="id" value="$_id" />
						<button form="delete-todo-$_id" type="submit" class="ctrl-button contrast material-icons" >delete</button>

					</fieldset>
				</form>

				<!-- Hidden form to delete -->
				<form id="delete-todo-$_id" method="POST" v-name="delete_todo" >
					<v-sql-action>
						delete from simple.todos where _id = $.body.id
					</v-sql-action>
					<input type="hidden" name="id" value="$_id" />
				</form>

			</v-for-each>
		</main>
	</body>

</html>
